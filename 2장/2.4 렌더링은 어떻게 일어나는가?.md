# 🧐 렌더링은 어떻게 일어나는가?

리액트의 렌더링은 브라우저가 렌더링에 필요한 DOM 트리를 만드는 과정을 의미

### 리액트의 렌더링이란?

리액트에서의 렌더링이란 리액트 애플리케이션 트리 안에 있는 모든 컴포넌트들이 현재 자신들이 가지고 있는 props와 state의 값을 기반으로 어떻게 UI를 구성하고 이를 바탕으로 어떤 DOM 결과를 브라우저에 제공할 것인지 계산하는 일련의 과정을 의미

### 리액트의 렌더링이 일어나는 이유

1. 최초 렌더링: 사용자가 처음 애플리케이션에 진입하면 당연히 렌더링해야 할 결과물이 필요
2. 리렌더링: 최초 렌더링 이후의 모든 렌더링

   - 클래스 컴포넌트의 setState가 실행되는 경우: state의 변화는 컴포넌트 상태의 변화를 의미
   - 클래스 컴포넌트의 forceUpdate가 실행되는 경우: 명시적으로 렌더링을 강제하는 경우. 개발자가 강제로 렌더링이 필요하다고 선언한 것으로 간주해 shouldComponentUpdate 메서드를 무시하고 렌더링을 강제하게 된다.
   - 함수 컴포넌트의 useState()의 두 번째 배열 요소인 setter가 실행되는 경우
   - 함수 컴포넌트의 useReducer()의 두 번째 배열 요소인 dispatch가 실행되는 경우
   - 컴포넌트의 key props가 변경되는 경우

     **key가 필요한 이유?**

     리렌더링이 발생하는 동안 형제 요소들 사이에서 동일한 요소를 식별하는 값
     key가 존재한다면 두 트리 사이에서 동일한 key를 가지고 있는 컴포넌트는 이를 기준으로 구별할 수 있지만, 이 key가 없다면 단순히 파이버 내부의 sibling 인덱스만을 기준으로 판단

   - props가 변경되는 경우: 부모로부터 전달받는 값인 props가 달라지면 이를 사용하는 자식 컴포넌트에서도 변경이 필요하므로 리렌더링이 일어난다.

   - 부모 컴포넌트가 렌더링될 경우: 부모 컴포넌트가 리렌더링 된다면 자식 컴포넌트도 무조건 리렌더링

### 리액트의 렌더링 프로세스

컴포넌트의 루트에서부터 차근차근 아래쪽으로 내려가면서 업데이트가 필요하다고 지정돼 있는 모든 컴포넌트를 찾음

```jsx
{type: 'div', props: {children: [{type: 'span', props: {children: 'Hello'}}]}}
```

위와 같은 결과물의 객체를 반환하며 새로운 트리인 가상 DOM과 비교해 실제 DOM에 반영하기 위한 모든 변경 사항을 수집
이렇게 계산하는 과정을 바로 재조정(reconciliation)이라고 함

### 렌더와 커밋

- 렌더 단계 : 컴포넌트를 렌더링하고 변경 사항을 계산하는 모든 작업, 비교하는 것은 크게 type, props, key 세 가지 요소를 기준으로 비교
- 커밋 단계 : 렌더 단계의 변경 사항을 실제 DOM에 적용해 사용자에게 보여주는 과정

커밋 단계에서 업데이트한다면 이렇게 만들어진 모든 DOM 노드 및 인스턴스를 가리키도록 리액트 내부의 참조를 업데이트한다. 그다음, 생명주기 개념이 있는 클래스 컴포넌트에서는 componentDidMount, componentDidUpdate 메서드를 호출하고, 함수 컴포넌트에서는 useLayoutEffect 훅을 호출하게 된다.

중요한 사실은 리액트의 렌더링이 일어난다고 해서 무조건 DOM 업데이트가 일어나는 것은 아니다
